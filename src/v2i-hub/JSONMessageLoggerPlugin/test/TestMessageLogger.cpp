#include <gtest/gtest.h>
#include <tmx/messages/TmxJ2735.hpp>
#include <tmx/messages/TmxJ2735Codec.hpp>
#include <tmx/j2735_messages/J2735MessageFactory.hpp>
#include <boost/log/core.hpp>
#include <boost/log/sinks/text_ostream_backend.hpp>
#include <boost/log/sources/severity_channel_logger.hpp>
#include <boost/log/utility/setup/common_attributes.hpp>
#include <boost/log/expressions.hpp>
#include <boost/shared_ptr.hpp>
#include <sstream> // Required for std::ostringstream
#include <MessageLogger.hpp>
#include <boost/core/null_deleter.hpp>
#include <tmx/j2735_messages/BasicSafetyMessage.hpp>

namespace logging = boost::log;
namespace sinks = boost::log::sinks;
namespace src = boost::log::sources;
namespace expr = boost::log::expressions;

namespace JSONMessageLoggerPlugin {
    class TestMessageLoggerFixture : public ::testing::Test {
        public:
            std::ostringstream oss;


    protected:
        void SetUp() override {
            // Create a text stream backend
            boost::shared_ptr<sinks::text_ostream_backend> backend =
                boost::make_shared<sinks::text_ostream_backend>();

            // Add the ostringstream to the backend
            // Note: boost::shared_ptr is used to manage the stream lifetime,
            // and boost::null_deleter is used if you don't want the backend to delete the stream.
            // In this case, since oss is on the stack, it's safer to manage its lifetime manually.
            backend->add_stream(boost::shared_ptr<std::ostream>(&oss, boost::null_deleter()));

            // Create a sink front-end and attach the backend
            typedef sinks::synchronous_sink<sinks::text_ostream_backend> ostream_sink;
            boost::shared_ptr<ostream_sink> sink(new ostream_sink(backend));

            // Register the sink with the logging core
            logging::core::get()->add_sink(sink);

            // Add common attributes (like LineID, TimeStamp)
            logging::add_common_attributes();

        }

        void TearDown() override {
            // Cleanup code if needed
        }
    };

    // Add tests for MessageLogger functions here
    TEST(TestMessageLogger, routeableMessageToJsonStringValidMessage) {
        // Create a mock routeable_message containing a valid J2735 MessageFrame
        tmx::byte_stream bytes = tmx::byte_stream_decode("0012822138713020311b27c535a4e8ac6b49c0c5109602dc2522f100001e480cc800000002b5962bc282900000000000000e22f62aff9080a400000000000000ac0600018096068000c06481cc800000002b5d282c282a800000000000000000000000000388bd91bfe4202a8000000000000000000000000000ac26000180561e4000c04200aa400000002b575dc809c45eea9fd405050806a900000000ad65600027387bb17f512022200000002a8bd20502711501421805052e00a60302828560f0000802b014000402240c4400000005541a42604e72e02c5ed02828505a1a02b0f8000401586900020108019900000002a7481f602711700032a814282804072100b32000000054bf03ec04e22dfd46da02850501e04c4804480000000a89f9db4282800000e22ccb6fe50a0a000003ecd4c157fc80a0a000004142b058000201583a00010112051200000002a26f6210a0a00000388b2f8bfa8202800000d4cb37fb4080a000000ac36000080561640004042002240000000a89fa2e809c4599a200004fb353001ff840a0a1009120000000544ef3f004e22cd49007027d9a97a6ffe0050512044200000002a736d7302738700fca20dff3c951581c0004012c15000200c904210000000152f36c8050510000000007397016c8e040510000000005bfc78c41014400000000056170001002b09200080210077200000005510dae604e70e01f8dc1c0039b0201ee40000000aa7675e809ce1c0531aab7f572b009f6");
        tmx::messages::MapDataEncodedMessage encodedMap;
        encodedMap.set_data(bytes);
        tmx::routeable_message *rMsg = dynamic_cast<tmx::routeable_message *>(&encodedMap);

        // Call function under test
        std::string jsonStr = routeableMessageToJsonString(*rMsg);
        EXPECT_FALSE(jsonStr.empty());
        std::string expectJson = "{\"messageId\":\"18\",\"value\":{\"MapData\":{\"msgIssueRevision\":\"113\",\"layerType\":\"intersectionData\",\"layerID\":\"1\",\"intersections\":[{\"id\":{\"id\":\"36243\"},\"revision\":\"113\",\"refPoint\":{\"lat\":\"-84\",\"long\":\"-4410\",\"elevation\":\"150\"},\"laneWidth\":\"366\",\"speedLimits\":[{\"type\":\"vehicleMaxSpeed\",\"speed\":\"1118\"},{\"type\":\"vehicleMinSpeed\",\"speed\":\"0\"}],\"laneSet\":[{\"laneID\":\"6\",\"ingressApproach\":\"6\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1381\",\"y\":\"175\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2837\",\"y\":\"-7\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"1\",\"maneuver\":\"8000\"},\"signalGroup\":\"6\",\"connectionID\":\"2\"},{\"connectingLane\":{\"lane\":\"3\",\"maneuver\":\"4000\"},\"signalGroup\":\"6\",\"connectionID\":\"3\"}]},{\"laneID\":\"14\",\"ingressApproach\":\"6\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1396\",\"y\":\"523\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2851\",\"y\":\"-7\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"9\",\"maneuver\":\"8000\"},\"signalGroup\":\"6\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"15\",\"maneuver\":\"2000\"},\"signalGroup\":\"6\",\"connectionID\":\"2\"}]},{\"laneID\":\"5\",\"egressApproach\":\"5\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1373\",\"y\":\"-142\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2986\",\"y\":\"-22\"}},\"attributes\":{\"dElevation\":\"10\"}}]}},{\"laneID\":\"13\",\"egressApproach\":\"5\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1381\",\"y\":\"-512\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2993\",\"y\":\"-22\"}}}]}},{\"laneID\":\"4\",\"ingressApproach\":\"4\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"189\",\"y\":\"-1531\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY3\":{\"x\":\"10\",\"y\":\"-1780\"}},\"attributes\":{\"dElevation\":\"10\"}},{\"delta\":{\"node-XY4\":{\"x\":\"5\",\"y\":\"-2557\"}},\"attributes\":{\"dElevation\":\"10\"}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"7\",\"maneuver\":\"8000\"},\"signalGroup\":\"4\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"1\",\"maneuver\":\"4000\"},\"signalGroup\":\"4\",\"connectionID\":\"2\"}]},{\"laneID\":\"12\",\"ingressApproach\":\"4\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"525\",\"y\":\"-1517\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"22\",\"y\":\"-2579\"}},\"attributes\":{\"dElevation\":\"10\"}},{\"delta\":{\"node-XY3\":{\"x\":\"45\",\"y\":\"-1840\"}}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"15\",\"maneuver\":\"8000\"},\"signalGroup\":\"4\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"13\",\"maneuver\":\"2000\"},\"signalGroup\":\"4\",\"connectionID\":\"2\"}]},{\"laneID\":\"3\",\"egressApproach\":\"3\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-184\",\"y\":\"-1546\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"0\",\"y\":\"-2475\"}},\"attributes\":{\"dElevation\":\"20\"}},{\"delta\":{\"node-XY3\":{\"x\":\"4\",\"y\":\"-1934\"}}}]}},{\"laneID\":\"11\",\"egressApproach\":\"3\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-520\",\"y\":\"-1546\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-22\",\"y\":\"-2342\"}},\"attributes\":{\"dElevation\":\"20\"}},{\"delta\":{\"node-XY3\":{\"x\":\"15\",\"y\":\"-2010\"}}}]}},{\"laneID\":\"2\",\"ingressApproach\":\"2\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1410\",\"y\":\"-147\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2469\",\"y\":\"-27\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-10\"}},{\"delta\":{\"node-XY6\":{\"x\":\"-13291\",\"y\":\"-56\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"10\"}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"5\",\"maneuver\":\"8000\"},\"signalGroup\":\"2\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"7\",\"maneuver\":\"4000\"},\"signalGroup\":\"2\",\"connectionID\":\"2\"}]},{\"laneID\":\"10\",\"ingressApproach\":\"2\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1425\",\"y\":\"-479\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2575\",\"y\":\"-22\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}]}},{\"delta\":{\"node-XY6\":{\"x\":\"-13133\",\"y\":\"-76\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"13\",\"maneuver\":\"8000\"},\"signalGroup\":\"2\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"11\",\"maneuver\":\"2000\"},\"signalGroup\":\"2\",\"connectionID\":\"2\"}]},{\"laneID\":\"1\",\"egressApproach\":\"1\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1410\",\"y\":\"186\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2456\",\"y\":\"0\"}},\"attributes\":{\"dElevation\":\"-10\"}},{\"delta\":{\"node-XY6\":{\"x\":\"-13312\",\"y\":\"-31\"}},\"attributes\":{\"dElevation\":\"10\"}}]}},{\"laneID\":\"9\",\"egressApproach\":\"1\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1417\",\"y\":\"504\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2396\",\"y\":\"7\"}},\"attributes\":{\"dElevation\":\"-10\"}},{\"delta\":{\"node-XY6\":{\"x\":\"-13357\",\"y\":\"-16\"}},\"attributes\":{\"dElevation\":\"10\"}}]}},{\"laneID\":\"8\",\"ingressApproach\":\"8\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-202\",\"y\":\"1395\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"15\",\"y\":\"2372\"}}},{\"delta\":{\"node-XY4\":{\"x\":\"-7\",\"y\":\"3221\"}}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"3\",\"maneuver\":\"8000\"},\"signalGroup\":\"8\",\"connectionID\":\"2\"},{\"connectingLane\":{\"lane\":\"5\",\"maneuver\":\"4000\"},\"signalGroup\":\"8\",\"connectionID\":\"3\"}]},{\"laneID\":\"16\",\"ingressApproach\":\"8\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-538\",\"y\":\"1424\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"22\",\"y\":\"2332\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}},{\"delta\":{\"node-XY4\":{\"x\":\"-15\",\"y\":\"3170\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"11\",\"maneuver\":\"8000\"},\"signalGroup\":\"8\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"9\",\"maneuver\":\"2000\"},\"signalGroup\":\"8\",\"connectionID\":\"2\"}]},{\"laneID\":\"7\",\"egressApproach\":\"7\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"134\",\"y\":\"1395\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"15\",\"y\":\"2268\"}}},{\"delta\":{\"node-XY4\":{\"x\":\"0\",\"y\":\"3288\"}}}]}},{\"laneID\":\"15\",\"egressApproach\":\"7\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"473\",\"y\":\"1402\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"20\",\"y\":\"2261\"}}},{\"delta\":{\"node-XY4\":{\"x\":\"-22\",\"y\":\"3244\"}},\"attributes\":{\"dElevation\":\"-10\"}}]}}]}]}}}\n";
        EXPECT_EQ(expectJson, jsonStr);
    }

    TEST(TestMessageLogger, routableMessageToJsonStringInvalidMessage) {
        // Create a mock routeable_message containing an invalid message with first 2 bytes removed
        tmx::byte_stream bytes = tmx::byte_stream_decode("822138713020311b27c535a4e8ac6b49c0c5109602dc2522f100001e480cc800000002b5962bc282900000000000000e22f62aff9080a400000000000000ac0600018096068000c06481cc800000002b5d282c282a800000000000000000000000000388bd91bfe4202a8000000000000000000000000000ac26000180561e4000c04200aa400000002b575dc809c45eea9fd405050806a900000000ad65600027387bb17f512022200000002a8bd20502711501421805052e00a60302828560f0000802b014000402240c4400000005541a42604e72e02c5ed02828505a1a02b0f8000401586900020108019900000002a7481f602711700032a814282804072100b32000000054bf03ec04e22dfd46da02850501e04c4804480000000a89f9db4282800000e22ccb6fe50a0a000003ecd4c157fc80a0a000004142b058000201583a00010112051200000002a26f6210a0a00000388b2f8bfa8202800000d4cb37fb4080a000000ac36000080561640004042002240000000a89fa2e809c4599a200004fb353001ff840a0a1009120000000544ef3f004e22cd49007027d9a97a6ffe0050512044200000002a736d7302738700fca20dff3c951581c0004012c15000200c904210000000152f36c8050510000000007397016c8e040510000000005bfc78c41014400000000056170001002b09200080210077200000005510dae604e70e01f8dc1c0039b0201ee40000000aa7675e809ce1c0531aab7f572b009f6");
        tmx::messages::MapDataEncodedMessage encodedMap;
        encodedMap.set_data(bytes);
        tmx::routeable_message *rMsg = dynamic_cast<tmx::routeable_message *>(&encodedMap);

        // Call function under test
        EXPECT_THROW(routeableMessageToJsonString(*rMsg), boost::wrapexcept<tmx::J2735Exception>);
    }

    TEST_F(TestMessageLoggerFixture, logRouteableMessage) {
        // Create a mock routeable_message containing a valid J2735 MessageFrame
        tmx::byte_stream bytes = tmx::byte_stream_decode("0012822138713020311b27c535a4e8ac6b49c0c5109602dc2522f100001e480cc800000002b5962bc282900000000000000e22f62aff9080a400000000000000ac0600018096068000c06481cc800000002b5d282c282a800000000000000000000000000388bd91bfe4202a8000000000000000000000000000ac26000180561e4000c04200aa400000002b575dc809c45eea9fd405050806a900000000ad65600027387bb17f512022200000002a8bd20502711501421805052e00a60302828560f0000802b014000402240c4400000005541a42604e72e02c5ed02828505a1a02b0f8000401586900020108019900000002a7481f602711700032a814282804072100b32000000054bf03ec04e22dfd46da02850501e04c4804480000000a89f9db4282800000e22ccb6fe50a0a000003ecd4c157fc80a0a000004142b058000201583a00010112051200000002a26f6210a0a00000388b2f8bfa8202800000d4cb37fb4080a000000ac36000080561640004042002240000000a89fa2e809c4599a200004fb353001ff840a0a1009120000000544ef3f004e22cd49007027d9a97a6ffe0050512044200000002a736d7302738700fca20dff3c951581c0004012c15000200c904210000000152f36c8050510000000007397016c8e040510000000005bfc78c41014400000000056170001002b09200080210077200000005510dae604e70e01f8dc1c0039b0201ee40000000aa7675e809ce1c0531aab7f572b009f6");
        tmx::messages::MapDataEncodedMessage encodedMap;
        encodedMap.set_data(bytes);
        tmx::routeable_message *rMsg = dynamic_cast<tmx::routeable_message *>(&encodedMap);
        boost::log::sources::severity_channel_logger<boost::log::trivial::severity_level, std::string> lg(boost::log::keywords::channel = "test");
        logRouteableMessage(*rMsg, lg);

        oss.flush();
        std::string logOutput = oss.str();
        EXPECT_FALSE(logOutput.empty());
        std::string expectJson = "{\"messageId\":\"18\",\"value\":{\"MapData\":{\"msgIssueRevision\":\"113\",\"layerType\":\"intersectionData\",\"layerID\":\"1\",\"intersections\":[{\"id\":{\"id\":\"36243\"},\"revision\":\"113\",\"refPoint\":{\"lat\":\"-84\",\"long\":\"-4410\",\"elevation\":\"150\"},\"laneWidth\":\"366\",\"speedLimits\":[{\"type\":\"vehicleMaxSpeed\",\"speed\":\"1118\"},{\"type\":\"vehicleMinSpeed\",\"speed\":\"0\"}],\"laneSet\":[{\"laneID\":\"6\",\"ingressApproach\":\"6\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1381\",\"y\":\"175\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2837\",\"y\":\"-7\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"1\",\"maneuver\":\"8000\"},\"signalGroup\":\"6\",\"connectionID\":\"2\"},{\"connectingLane\":{\"lane\":\"3\",\"maneuver\":\"4000\"},\"signalGroup\":\"6\",\"connectionID\":\"3\"}]},{\"laneID\":\"14\",\"ingressApproach\":\"6\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1396\",\"y\":\"523\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2851\",\"y\":\"-7\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"9\",\"maneuver\":\"8000\"},\"signalGroup\":\"6\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"15\",\"maneuver\":\"2000\"},\"signalGroup\":\"6\",\"connectionID\":\"2\"}]},{\"laneID\":\"5\",\"egressApproach\":\"5\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1373\",\"y\":\"-142\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2986\",\"y\":\"-22\"}},\"attributes\":{\"dElevation\":\"10\"}}]}},{\"laneID\":\"13\",\"egressApproach\":\"5\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"1381\",\"y\":\"-512\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"2993\",\"y\":\"-22\"}}}]}},{\"laneID\":\"4\",\"ingressApproach\":\"4\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"189\",\"y\":\"-1531\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY3\":{\"x\":\"10\",\"y\":\"-1780\"}},\"attributes\":{\"dElevation\":\"10\"}},{\"delta\":{\"node-XY4\":{\"x\":\"5\",\"y\":\"-2557\"}},\"attributes\":{\"dElevation\":\"10\"}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"7\",\"maneuver\":\"8000\"},\"signalGroup\":\"4\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"1\",\"maneuver\":\"4000\"},\"signalGroup\":\"4\",\"connectionID\":\"2\"}]},{\"laneID\":\"12\",\"ingressApproach\":\"4\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"525\",\"y\":\"-1517\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"22\",\"y\":\"-2579\"}},\"attributes\":{\"dElevation\":\"10\"}},{\"delta\":{\"node-XY3\":{\"x\":\"45\",\"y\":\"-1840\"}}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"15\",\"maneuver\":\"8000\"},\"signalGroup\":\"4\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"13\",\"maneuver\":\"2000\"},\"signalGroup\":\"4\",\"connectionID\":\"2\"}]},{\"laneID\":\"3\",\"egressApproach\":\"3\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-184\",\"y\":\"-1546\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"0\",\"y\":\"-2475\"}},\"attributes\":{\"dElevation\":\"20\"}},{\"delta\":{\"node-XY3\":{\"x\":\"4\",\"y\":\"-1934\"}}}]}},{\"laneID\":\"11\",\"egressApproach\":\"3\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-520\",\"y\":\"-1546\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-22\",\"y\":\"-2342\"}},\"attributes\":{\"dElevation\":\"20\"}},{\"delta\":{\"node-XY3\":{\"x\":\"15\",\"y\":\"-2010\"}}}]}},{\"laneID\":\"2\",\"ingressApproach\":\"2\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1410\",\"y\":\"-147\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2469\",\"y\":\"-27\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-10\"}},{\"delta\":{\"node-XY6\":{\"x\":\"-13291\",\"y\":\"-56\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"10\"}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"5\",\"maneuver\":\"8000\"},\"signalGroup\":\"2\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"7\",\"maneuver\":\"4000\"},\"signalGroup\":\"2\",\"connectionID\":\"2\"}]},{\"laneID\":\"10\",\"ingressApproach\":\"2\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1425\",\"y\":\"-479\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2575\",\"y\":\"-22\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}]}},{\"delta\":{\"node-XY6\":{\"x\":\"-13133\",\"y\":\"-76\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"13\",\"maneuver\":\"8000\"},\"signalGroup\":\"2\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"11\",\"maneuver\":\"2000\"},\"signalGroup\":\"2\",\"connectionID\":\"2\"}]},{\"laneID\":\"1\",\"egressApproach\":\"1\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1410\",\"y\":\"186\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2456\",\"y\":\"0\"}},\"attributes\":{\"dElevation\":\"-10\"}},{\"delta\":{\"node-XY6\":{\"x\":\"-13312\",\"y\":\"-31\"}},\"attributes\":{\"dElevation\":\"10\"}}]}},{\"laneID\":\"9\",\"egressApproach\":\"1\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-1417\",\"y\":\"504\"}},\"attributes\":{\"dElevation\":\"-60\"}},{\"delta\":{\"node-XY4\":{\"x\":\"-2396\",\"y\":\"7\"}},\"attributes\":{\"dElevation\":\"-10\"}},{\"delta\":{\"node-XY6\":{\"x\":\"-13357\",\"y\":\"-16\"}},\"attributes\":{\"dElevation\":\"10\"}}]}},{\"laneID\":\"8\",\"ingressApproach\":\"8\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-202\",\"y\":\"1395\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"15\",\"y\":\"2372\"}}},{\"delta\":{\"node-XY4\":{\"x\":\"-7\",\"y\":\"3221\"}}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"3\",\"maneuver\":\"8000\"},\"signalGroup\":\"8\",\"connectionID\":\"2\"},{\"connectingLane\":{\"lane\":\"5\",\"maneuver\":\"4000\"},\"signalGroup\":\"8\",\"connectionID\":\"3\"}]},{\"laneID\":\"16\",\"ingressApproach\":\"8\",\"laneAttributes\":{\"directionalUse\":\"80\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"-538\",\"y\":\"1424\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}],\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"22\",\"y\":\"2332\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}},{\"delta\":{\"node-XY4\":{\"x\":\"-15\",\"y\":\"3170\"}},\"attributes\":{\"data\":[{\"speedLimits\":[{\"type\":\"unknown\",\"speed\":\"0\"},{\"type\":\"unknown\",\"speed\":\"0\"}]}]}}]},\"connectsTo\":[{\"connectingLane\":{\"lane\":\"11\",\"maneuver\":\"8000\"},\"signalGroup\":\"8\",\"connectionID\":\"1\"},{\"connectingLane\":{\"lane\":\"9\",\"maneuver\":\"2000\"},\"signalGroup\":\"8\",\"connectionID\":\"2\"}]},{\"laneID\":\"7\",\"egressApproach\":\"7\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"134\",\"y\":\"1395\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"15\",\"y\":\"2268\"}}},{\"delta\":{\"node-XY4\":{\"x\":\"0\",\"y\":\"3288\"}}}]}},{\"laneID\":\"15\",\"egressApproach\":\"7\",\"laneAttributes\":{\"directionalUse\":\"40\",\"sharedWith\":\"0000\",\"laneType\":{\"vehicle\":\"00\"}},\"nodeList\":{\"nodes\":[{\"delta\":{\"node-XY3\":{\"x\":\"473\",\"y\":\"1402\"}},\"attributes\":{\"dElevation\":\"-50\"}},{\"delta\":{\"node-XY4\":{\"x\":\"20\",\"y\":\"2261\"}}},{\"delta\":{\"node-XY4\":{\"x\":\"-22\",\"y\":\"3244\"}},\"attributes\":{\"dElevation\":\"-10\"}}]}}]}]}}}\n";
        EXPECT_EQ(expectJson, logOutput);
    }

}