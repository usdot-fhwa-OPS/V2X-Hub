## Telematic bridge introduction
Telematic bridge is a V2xHub plugin used to collect data stream generated by V2xHub and send the data stream into [telematic tool](https://github.com/usdot-fhwa-stol/cda-telematics) hosted in the AWS cloud.
## NATS Publisher/Subscriber
### NATS Connections and registration
#### Telematic plugin sends registration request to telematic server
##### Subject
NATS subject: *.register_unit
##### Request
```
{
  "unit_id": "<unit_id>"
}
```
##### Response
```
{
  "unit_id": "<unit_id>",
  "unit_type": "infrastructure",
  "unit_name": "East Intersection",
  "timestamp": "1678998191815233965",
  "event_name": "wfd_integration_testing",
  "location": "TFHRC",
  "testing_type": "Integration"
}
```

### Available topics
#### Telematic plugin receives request from telematic UI
##### Subject
NATS subject: <unit_id>.available_topics
##### Request
```
{
  "unit_id": "<unit_id>"
}
```
##### Reply

```
 {
  "unit_id": "<unit_id>",
  "unit_type": "infrastructure",
  "unit_name": "East Intersection",
  "timestamp": "1678998191815233965",
  "event_name": "wfd_integration_testing",
  "location": "TFHRC",
  "testing_type": "Integration",
  "topics": [
    {
      "name": "J2735_TMSG03-P_CARMAStreetsPlugin"
    },
    {
      "name": "<topic_name_2>"
    }
  ]
}
```

### Selected topics
#### Telematic plugin receives selected topics from telematic UI
##### Subject
NATS subject: <unit_id>.publish_topics
#### Request
```
{
  "unit_id": "<unit_id>",
  "unit_type": "infrastructure",
  "timestamp": 1663084528513000400,
  "event_name": "wfd_integration_testing",
  "location": "TFHRC",
  "testing_type": "Integration",
  "topics": [
    "<topic_name_1>",
    "<topic_name_2>"
  ]
}
```
##### Reply
```
"request received!"
```

## Check status
#### Telematic plugin receives live status request from telematic server
##### Subject
NATS subject: <unit_id>.check_status
##### Request
```
{
  "unit_id": "<unit_id>"
}
```
##### Reponse
```
"OK"
```

## Telematic RSU Unit (TRU) Configuration

### Overview
TRU mode enables direct RSU integration with configuration management, health monitoring, and selecting and streaming of RSU specific topics through NATS messaging.

### Environment Variables
```bash
IS_TRU=true                          # Enable TRU mode
INFRASTRUCTURE_ID=Unit001            # Unit identifier
INFRASTRUCTURE_NAME=EastIntersection # Unit name
NATS_URL=nats://localhost:4222      # NATS server URL
RSU_CONFIG_PATH=/config/rsu.json    # RSU configuration file path
```

### RSU Configuration File
```json
{
  "unitConfig": [{
    "unitID": "Unit001",
    "maxConnections": 10
  }],
  "rsuConfigs": [{
    "action": "add",
    "event": "startup",
    "rsu": {
      "ip": "192.168.1.10",
      "port": 161
    },
    "snmp": {
      "user": "admin",
      "privacyprotocol": "AES",
      "authprotocol": "SHA",
      "authpassphrase": "pass123",
      "privacypassphrase": "priv123",
      "rsumibversion": "4.1",
      "securitylevel": "authPriv"
    }
  }],
  "timestamp": 1234567890
}
```

### RSU Registration
#### Telematic RSU Unit sends registration to server
##### Subject
`unit.<unit_id>.register.rsu.config`

##### Message
```json
{
  "unitConfig": [{
    "unitID": "Unit001",
    "maxConnections": 10,
    "bridgePluginHeartbeatInterval": 30,
    "healthMonitorPluginHeartbeatInterval": 60,
    "rsuStatusMonitorInterval": 120
  }],
  "rsuConfigs": [{
    "action": "add",
    "event": "startup",
    "rsu": {"ip": "192.168.1.10", "port": 161},
    "snmp": {...}
  }],
  "timestamp": 1234567890
}
```

##### Response
```json
{
  "unitConfig": [{"unitID": "Unit001"}],
  "rsuConfigs": [
    {"ip": "192.168.1.10", "port": 161}
  ],
  "status": "success",
  "timestamp": 1234567890
}
```

### RSU Configuration Updates
Server can send configuration updates to add, update, or remove RSUs. TRU validates unit ID and applies changes to registered RSU list.

**Actions:** `add`, `update`, `delete`